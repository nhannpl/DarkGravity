<div class="feed-container">
    <div class="feed-header fade-in">
        <h2 class="section-title">Fresh Encounters</h2>
        <p class="section-subtitle">The latest transmissions from the abyss.</p>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar glass fade-in">
        <div class="filter-group">
            <label for="sort-select">Sort By</label>
            <div class="select-wrapper">
                <select id="sort-select" (change)="onSortChange($event)" class="filter-select">
                    <option value="Upvotes:desc">Most Viral</option>
                    <option value="ScaryScore:desc">Scariest</option>
                    <option value="FetchedAt:desc">Newest</option>
                    <option value="Title:asc">A-Z</option>
                </select>
                <span class="select-arrow">▾</span>
            </div>
        </div>
    
        <div class="filter-group">
            <div class="filter-label-row">
                <label for="scary-range">Scary Score</label>
                <span class="range-value">{{ searchService.minScaryScore() }}+</span>
            </div>
            <input type="range" id="scary-range" min="0" max="10" step="1" [value]="searchService.minScaryScore()"
                (input)="onScaryScoreChange($event)" class="filter-range">
        </div>
    
        <div class="filter-stats">
            <span class="stat-count">{{ stories().length }}</span>
            <span class="stat-label">Results</span>
        </div>
    </div>

    <div *ngIf="loading()" class="skeleton-grid">
        <div *ngFor="let i of [1,2,3,4,5,6]" class="skeleton-card glass"></div>
    </div>

    <div *ngIf="!loading() && stories().length === 0" class="empty-state fade-in">
        <div class="empty-icon">♢</div>
        <h3>The Abyss is Silent</h3>
        <p>No transmissions match your current filters.</p>
    </div>

    <div *ngIf="!loading() && stories().length > 0">
        <!-- Top Pagination -->
        <app-pagination [currentPage]="searchService.page()" [totalPages]="totalPages()"
            [pageSize]="searchService.pageSize()" (pageChange)="onPageChange($event)"
            (pageSizeChange)="onPageSizeChange($event)" class="pagination-top">
        </app-pagination>
    
        <div class="story-grid">
            <article *ngFor="let story of stories(); let i = index" class="story-card glass fade-in"
                [style.animation-delay]="i * 0.1 + 's'" [routerLink]="['/story', story.id]">

                <div class="card-glow"></div>

                <div class="card-content">
                    <div class="card-header">
                        <div class="header-tags">
                            <span class="scary-tag" [attr.data-level]="getScaryLevel(story.scaryScore)">
                                {{ getScaryLevel(story.scaryScore) }}
                            </span>
                            <a [href]="story.url" target="_blank" class="source-link" (click)="$event.stopPropagation()">
                                <span class="source-tag" [attr.data-source]="getStorySource(story.url)">
                                    {{ getStorySource(story.url) }} ↗
                                </span>
                            </a>
                        </div>
                        <span class="story-date">{{ story.fetchedAt | date:'MMM d' }}</span>
                        </div>

                    <h3 class="story-title">{{ story.title }}</h3>

                    <p class="story-excerpt">
                        {{ story.bodyText | slice:0:150 }}...
                    </p>

                    <div class="card-footer">
                        <div class="score-indicator">
                            <div class="score-label">Anomaly level</div>
                            <div class="score-bar-bg">
                                <div class="score-bar-fill" [style.width.%]="story.scaryScore * 10"></div>
                            </div>
                            <div class="score-value">{{ story.scaryScore }}/10</div>
                        </div>

                        <div class="card-actions">
                            <button class="read-btn" [routerLink]="['/story', story.id]">
                                READ TRACE
                            </button>
                            <a [href]="story.url" target="_blank" class="original-link" (click)="$event.stopPropagation()">
                                ORIGINAL POST ↗
                            </a>
                        </div>
                        </div>
                        </div>
                        </article>
        </div>
        
        <!-- Pagination -->
        <app-pagination [currentPage]="searchService.page()" [totalPages]="totalPages()" [pageSize]="searchService.pageSize()"
            (pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)">
        </app-pagination>
    </div>
</div>