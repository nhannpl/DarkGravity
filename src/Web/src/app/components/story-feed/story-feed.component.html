<div class="feed-container">
    <div class="feed-header fade-in">
        <h2 class="section-title">Fresh Encounters</h2>
        <p class="section-subtitle">The latest transmissions from the abyss.</p>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar glass fade-in">
        <div class="filter-group">
            <label for="sort-select">Sort By</label>
            <div class="select-wrapper">
                <select id="sort-select" (change)="onSortChange($event)" class="filter-select">
                    <option value="Upvotes:desc">Most Viral</option>
                    <option value="ScaryScore:desc">Scariest</option>
                    <option value="FetchedAt:desc">Newest</option>
                    <option value="Title:asc">A-Z</option>
                </select>
                <span class="select-arrow">‚ñæ</span>
            </div>
        </div>

        <div class="filter-group">
            <label for="platform-select">Platform</label>
            <div class="select-wrapper">
                <select id="platform-select" (change)="onPlatformChange($event)" class="filter-select">
                    <option value="">All Sources üåê</option>
                    <option value="reddit">Reddit üëΩ</option>
                    <option value="youtube">YouTube ‚ñ∂Ô∏è</option>
                </select>
                <span class="select-arrow">‚ñæ</span>
            </div>
        </div>
        <div class="filter-group">
            <div class="filter-label-row">
                <label for="scary-range">Scary Score</label>
                <span class="range-value">{{ searchService.minScaryScore() }} - {{ searchService.maxScaryScore() }}</span>
            </div>
            <div class="range-input-container">
                <div class="range-track" [style.background]="getTrackGradient()"></div>
                <!-- Min Slider -->
                <input type="range" min="0" max="10" step="1" [value]="searchService.minScaryScore()"
                    (input)="onMinScaryScoreChange($event)" class="filter-range dual-range min-range">
            
                <!-- Max Slider -->
                <input type="range" min="0" max="10" step="1" [value]="searchService.maxScaryScore()"
                    (input)="onMaxScaryScoreChange($event)" class="filter-range dual-range max-range">
            </div>
        </div>
    
        <div class="filter-stats">
            <span class="stat-count">{{ totalCount() }}</span>
            <span class="stat-label">Results</span>
        </div>
    </div>

    <div *ngIf="loading()" class="skeleton-grid">
        <div *ngFor="let i of [1,2,3,4,5,6]" class="skeleton-card glass"></div>
    </div>

    <div *ngIf="!loading() && stories().length === 0" class="empty-state fade-in">
        <div class="empty-icon">‚ô¢</div>
        <h3>The Abyss is Silent</h3>
        <p>No transmissions match your current filters.</p>
    </div>

    <div *ngIf="!loading() && stories().length > 0">
        <!-- Top Pagination -->
        <app-pagination [currentPage]="searchService.page()" [totalPages]="totalPages()"
            [pageSize]="searchService.pageSize()" (pageChange)="onPageChange($event)"
            (pageSizeChange)="onPageSizeChange($event)" class="pagination-top">
        </app-pagination>
    
        <div class="story-grid">
            <article *ngFor="let story of stories(); let i = index" class="story-card glass fade-in"
                [style.animation-delay]="i * 0.1 + 's'" [routerLink]="['/story', story.id]">

                <div class="card-glow"></div>

                <div class="card-content">
                    <div class="card-header">
                        <div class="header-tags">
                            <span class="scary-tag" [attr.data-level]="getScaryLevel(story.scaryScore)">
                                {{ getScaryLevel(story.scaryScore) }}
                            </span>
                            <a [href]="story.url" target="_blank" class="source-link" (click)="$event.stopPropagation()">
                                <span class="source-tag" [attr.data-source]="getStorySource(story.url)">
                                    <ng-container [ngSwitch]="getStorySource(story.url)">
                                        <svg *ngSwitchCase="'REDDIT'" class="source-icon" viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                            <path
                                                d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z" />
                                        </svg>
                                        <svg *ngSwitchCase="'YOUTUBE'" class="source-icon" viewBox="0 0 24 24" width="14" height="14" fill="currentColor">
                                            <path
                                                d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                                        </svg>
                                    </ng-container>
                                    {{ getStorySource(story.url) }} ‚Üó
                                </span>
                            </a>
                        </div>
                        <span class="story-date">{{ story.fetchedAt | date:'MMM d' }}</span>
                        </div>

                    <h3 class="story-title">{{ story.title }}</h3>

                    <p class="story-excerpt">
                        {{ story.bodyText | slice:0:150 }}...
                    </p>

                    <div class="card-footer">
                        <div class="score-indicator">
                            <div class="score-label">Anomaly level</div>
                            <div class="score-bar-bg">
                                <div class="score-bar-fill" [style.width.%]="story.scaryScore * 10"></div>
                            </div>
                            <div class="score-value">{{ story.scaryScore }}/10</div>
                        </div>

                        <div class="card-actions">
                            <button class="read-btn" [routerLink]="['/story', story.id]">
                                READ TRACE
                            </button>
                            <a [href]="story.url" target="_blank" class="original-link" (click)="$event.stopPropagation()">
                                ORIGINAL POST ‚Üó
                            </a>
                        </div>
                        </div>
                        </div>
                        </article>
        </div>
        
        <!-- Pagination -->
        <app-pagination [currentPage]="searchService.page()" [totalPages]="totalPages()" [pageSize]="searchService.pageSize()"
            (pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)">
        </app-pagination>
    </div>
</div>